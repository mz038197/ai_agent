# å‡ç´šåˆ° Agent æ¨¡å¼æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°‡å¹«åŠ©ä½ å¾åŸºç¤ç‰ˆæœ¬å‡ç´šåˆ°æ”¯æŒ Agent æ¨¡å¼çš„æ–°ç‰ˆæœ¬ã€‚

## ğŸš€ å¿«é€Ÿå‡ç´šæ­¥é©Ÿ

### 1. æ›´æ–°ä¾è³´

```bash
pip install -r requirements.txt
```

æ–°å¢çš„ä¾è³´ï¼š
- `duckduckgo-search` - ç¶²è·¯æœå°‹å·¥å…·

### 2. ä¸‹è¼‰ Agent å°ˆç”¨æ¨¡å‹

Agent æ¨¡å¼éœ€è¦æ”¯æŒå‡½æ•¸èª¿ç”¨ï¼ˆFunction Callingï¼‰çš„æ¨¡å‹ï¼š

```bash
# æ¨è–¦é¸æ“‡ï¼ˆæ“‡ä¸€å³å¯ï¼‰
ollama pull qwen2.5:7b        # â­ æ¨è–¦ï¼šä¸­æ–‡æ”¯æŒæœ€å¥½
ollama pull llama3.1:8b       # ä¹Ÿä¸éŒ¯
ollama pull mistral:7b        # è‹±æ–‡ç‚ºä¸»
```

### 3. æ¸¬è©¦ Agent åŠŸèƒ½

```bash
# é‹è¡Œæ¸¬è©¦è…³æœ¬
python test_agent.py
```

### 4. å•Ÿå‹•æ‡‰ç”¨

```bash
chainlit run app.py
```

åœ¨ UI ä¸­è¼¸å…¥ `/agent` åˆ‡æ›åˆ° Agent æ¨¡å¼ã€‚

## ğŸ“Š ç‰ˆæœ¬å°æ¯”

### èˆŠç‰ˆæœ¬
- âœ… åŸºç¤å°è©±
- âœ… åœ–ç‰‡åˆ†æ
- âœ… RAG çŸ¥è­˜åº«
- âœ… æ‰‹å‹•æ¨¡å¼åˆ‡æ›

### æ–°ç‰ˆæœ¬ï¼ˆæ‰€æœ‰èˆŠåŠŸèƒ½ + ï¼‰
- ğŸ†• **Agent æ¨¡å¼** - LLM è‡ªä¸»èª¿ç”¨å·¥å…·
- ğŸ†• **ç¶²è·¯æœå°‹** - DuckDuckGo é›†æˆ
- ğŸ†• **å·¥å…·å”ä½œ** - çŸ¥è­˜åº« + ç¶²è·¯æœå°‹çµ„åˆ
- ğŸ†• **æ™ºèƒ½æ¨ç†** - å¤šæ­¥æ¨ç†éˆè·¯

## ğŸ”§ é…ç½®è®Šæ›´

### app.py é…ç½®æ–°å¢é …

```python
CONFIG = {
    # æ–°å¢ Agent é…ç½®
    "AGENT_MODEL": "qwen2.5:7b",      # Agent å°ˆç”¨æ¨¡å‹
    "AGENT_TEMPERATURE": 0,           # Agent æº«åº¦ï¼ˆå»ºè­°ä½æº«ï¼‰
    "ENABLE_WEB_SEARCH": True,        # æ˜¯å¦å•Ÿç”¨ç¶²è·¯æœå°‹
    
    # åŸæœ‰é…ç½®ä¿æŒä¸è®Š
    "MODEL": "gemma3:4b",
    "BASE_URL": "http://localhost:11434",
    # ...
}
```

### æ–°å¢çš„æœå‹™

```python
# åœ¨ services/ ç›®éŒ„ä¸‹æ–°å¢
from services import AgentService

# ä½¿ç”¨æ–¹å¼
agent_service = AgentService(
    vector_store_service=vector_service,
    model="qwen2.5:7b",
    enable_web_search=True
)

result = agent_service.query("ä½ çš„å•é¡Œ")
```

## ğŸ¯ ä½¿ç”¨å ´æ™¯å°æ¯”

### ä½•æ™‚ä½¿ç”¨å„ç¨®æ¨¡å¼ï¼Ÿ

| å ´æ™¯ | æ¨è–¦æ¨¡å¼ | åŸå›  |
|------|---------|------|
| é–’èŠã€å¸¸è­˜å•é¡Œ | `/chat` | æœ€å¿«ï¼Œä¸éœ€è¦é¡å¤–å·¥å…· |
| æŸ¥è©¢å·²ä¸Šå‚³æ–‡æª” | `/rag` | å¼·åˆ¶ä½¿ç”¨çŸ¥è­˜åº« |
| æ··åˆå ´æ™¯ | `/auto` | è‡ªå‹•åˆ¤æ–·ï¼Œå¹³è¡¡æ€§èƒ½å’Œæº–ç¢ºæ€§ |
| éœ€è¦å¤šç¨®ä¿¡æ¯æº | `/agent` â­ | æœ€æ™ºèƒ½ï¼Œä½†æœ€æ…¢ |
| éœ€è¦æœ€æ–°è³‡è¨Š | `/agent` â­ | å¯ä»¥æœå°‹ç¶²è·¯ |
| è¤‡é›œæ¨ç†ä»»å‹™ | `/agent` â­ | æ”¯æ´å¤šæ­¥æ¨ç† |

## ğŸ“ ä»£ç¢¼ç¤ºä¾‹

### èˆŠç‰ˆæœ¬ä½¿ç”¨æ–¹å¼ï¼ˆä»ç„¶æ”¯æŒï¼‰

```python
# RAG æœå‹™ - æ‰‹å‹•åˆ¤æ–·
response = rag_service.query_with_context(
    query="RAG æ˜¯ä»€éº¼ï¼Ÿ",
    k=4
)
```

### æ–°ç‰ˆæœ¬ä½¿ç”¨æ–¹å¼

```python
# Agent æœå‹™ - LLM è‡ªå‹•åˆ¤æ–·
result = agent_service.query("RAG æ˜¯ä»€éº¼ï¼Ÿæœ€æ–°çš„ç™¼å±•å¦‚ä½•ï¼Ÿ")

# Agent æœƒè‡ªå‹•ï¼š
# 1. æª¢ç´¢çŸ¥è­˜åº«æ‰¾ RAG å®šç¾©
# 2. æœå°‹ç¶²è·¯æ‰¾æœ€æ–°ç™¼å±•
# 3. ç¶œåˆç”Ÿæˆå›ç­”
```

## âš ï¸ æ³¨æ„äº‹é …

### 1. æ¨¡å‹å…¼å®¹æ€§

ä¸æ˜¯æ‰€æœ‰ Ollama æ¨¡å‹éƒ½æ”¯æŒå‡½æ•¸èª¿ç”¨ï¼š

âœ… **æ”¯æŒ**ï¼š
- `qwen2.5:7b` â­
- `llama3.1:8b`
- `mistral:7b`

âŒ **ä¸æ”¯æŒ**ï¼š
- `gemma3:4b`ï¼ˆä½ ç¾æœ‰çš„æ¨¡å‹ï¼‰
- `llama2:7b`ï¼ˆèˆŠç‰ˆï¼‰

### 2. æ€§èƒ½è€ƒæ…®

Agent æ¨¡å¼æœƒï¼š
- âœ… æ›´æ™ºèƒ½ã€æ›´æº–ç¢º
- âŒ éŸ¿æ‡‰æ›´æ…¢ï¼ˆå¤šæ¬¡ LLM èª¿ç”¨ï¼‰
- âŒ æˆæœ¬æ›´é«˜ï¼ˆToken æ¶ˆè€—ï¼‰

å»ºè­°ç­–ç•¥ï¼š
- ç°¡å–®å•é¡Œï¼šç”¨ `/chat` æˆ– `/auto`
- è¤‡é›œå•é¡Œï¼šç”¨ `/agent`

### 3. ç¶²è·¯æœå°‹é™åˆ¶

- DuckDuckGo æœå°‹**ä¸éœ€è¦ API Key**
- ä½†å¯èƒ½å—åˆ°é »ç‡é™åˆ¶
- çµæœè³ªé‡ä¸å¦‚ Googleï¼ˆä½†å…è²»ï¼‰

å¦‚æœéœ€è¦æ›´å¥½çš„æœå°‹ï¼š
- å¯æ›¿æ›ç‚º Google Custom Search
- éœ€è¦ç”³è«‹ API Key

### 4. å‘å¾Œå…¼å®¹

- âœ… æ‰€æœ‰èˆŠåŠŸèƒ½å®Œå…¨ä¿ç•™
- âœ… ä¸ä½¿ç”¨ Agent æ¨¡å¼ä¸å—å½±éŸ¿
- âœ… å¯ä»¥éš¨æ™‚åœ¨æ¨¡å¼é–“åˆ‡æ›

## ğŸ” æ•…éšœæ’é™¤

### Agent æ¨¡å¼ä¸å¯ç”¨

```
âŒ Agent æ¨¡å¼ä¸å¯ç”¨
```

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. ç¢ºèªå·²å®‰è£ä¾è³´ï¼š
   ```bash
   pip install duckduckgo-search
   ```

2. ç¢ºèªå·²ä¸‹è¼‰æ¨¡å‹ï¼š
   ```bash
   ollama pull qwen2.5:7b
   ```

3. æª¢æŸ¥ Ollama ç‰ˆæœ¬ï¼š
   ```bash
   ollama --version
   # å»ºè­° >= 0.1.0
   ```

### ç¶²è·¯æœå°‹å¤±æ•—

å¦‚æœä¸éœ€è¦ç¶²è·¯æœå°‹åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ `app.py` ä¸­ç¦ç”¨ï¼š

```python
CONFIG = {
    "ENABLE_WEB_SEARCH": False,  # ç¦ç”¨ç¶²è·¯æœå°‹
    # ...
}
```

### Agent æ¨ç†éŒ¯èª¤

æŸ¥çœ‹è©³ç´°æ—¥èªŒï¼š

```python
# åœ¨ app.py åˆå§‹åŒ–æ™‚
agent_service = AgentService(
    ...,
    verbose=True  # é–‹å•Ÿè©³ç´°æ—¥èªŒ
)
```

## ğŸ“š é€²éšä½¿ç”¨

### æ·»åŠ è‡ªå®šç¾©å·¥å…·

åœ¨ `services/agent_service.py` ä¸­ï¼š

```python
def _create_tools(self, ...):
    tools = []
    
    # åŸæœ‰å·¥å…·
    tools.append(retriever_tool)
    tools.append(web_search_tool)
    
    # æ·»åŠ æ–°å·¥å…·
    from langchain_community.tools import WikipediaQueryRun
    wiki_tool = WikipediaQueryRun(
        name="wikipedia",
        description="æœå°‹ç¶­åŸºç™¾ç§‘"
    )
    tools.append(wiki_tool)
    
    return tools
```

### è‡ªå®šç¾© Agent æç¤ºè©

ä¿®æ”¹ `_get_system_prompt()` æ–¹æ³•ï¼š

```python
def _get_system_prompt(self) -> str:
    return """ä½ çš„è‡ªå®šç¾©æç¤ºè©..."""
```

## ğŸ“ å­¸ç¿’è³‡æº

- [AGENT_GUIDE.md](AGENT_GUIDE.md) - Agent ä½¿ç”¨æŒ‡å—
- [test_agent.py](test_agent.py) - Agent æ¸¬è©¦è…³æœ¬
- [LangChain å®˜æ–¹æ–‡æª”](https://python.langchain.com/docs/modules/agents/)

## âœ… æª¢æŸ¥æ¸…å–®

å‡ç´šå®Œæˆå¾Œï¼Œè«‹ç¢ºèªï¼š

- [ ] ä¾è³´å·²å®‰è£ï¼ˆ`pip install -r requirements.txt`ï¼‰
- [ ] Agent æ¨¡å‹å·²ä¸‹è¼‰ï¼ˆ`ollama pull qwen2.5:7b`ï¼‰
- [ ] æ¸¬è©¦è…³æœ¬é‹è¡ŒæˆåŠŸï¼ˆ`python test_agent.py`ï¼‰
- [ ] UI ä¸­å¯ä»¥åˆ‡æ›åˆ° Agent æ¨¡å¼ï¼ˆ`/agent`ï¼‰
- [ ] Agent å¯ä»¥æˆåŠŸèª¿ç”¨å·¥å…·
- [ ] èˆŠæœ‰åŠŸèƒ½ä»ç„¶æ­£å¸¸å·¥ä½œ

## ğŸ¤ éœ€è¦å¹«åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°å•é¡Œï¼š
1. æŸ¥çœ‹ [AGENT_GUIDE.md](AGENT_GUIDE.md) æ•…éšœæ’é™¤éƒ¨åˆ†
2. é‹è¡Œ `python test_agent.py` è¨ºæ–·å•é¡Œ
3. æª¢æŸ¥ Ollama æ—¥èªŒ

## ğŸ“ˆ å¾ŒçºŒè¨ˆåŠƒ

- [ ] æ”¯æ´æµå¼è¼¸å‡ºï¼ˆStreamingï¼‰
- [ ] æ·»åŠ æ›´å¤šå·¥å…·ï¼ˆè¨ˆç®—å™¨ã€æ•¸æ“šåº«ç­‰ï¼‰
- [ ] Agent å°è©±æ­·å²æŒä¹…åŒ–
- [ ] å·¥å…·ä½¿ç”¨çµ±è¨ˆå’Œåˆ†æ

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰
